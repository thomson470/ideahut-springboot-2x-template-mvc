const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-CYwS7Ngw.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/format-B8DKuPGh.js","assets/QTooltip-D4R9T5Fc.js","assets/QSpace-CfwQ6zIi.js","assets/QInnerLoading-DKttGab9.js","assets/QTable-CXYRITav.js","assets/ClosePopup-LSrQ-VjT.js","assets/TouchPan-B1-PqlLb.js","assets/Index-2Zuzj8Ve.js","assets/QSpinnerGears-BOF8vRdR.js","assets/Table3-DaxbvJfy.js"])))=>i.map(i=>d[i]);
import{_ as L,ag as U,Y as j,a7 as k,$ as c,f as i,a0 as s,C as V,Z as m,ai as T,a1 as D,a4 as f,a5 as y,a3 as g,a2 as v,F as x,a8 as P,aj as h,G as z,a9 as _,Q,an as G,ak as Y,ah as Z,al as F,r as u,am as S}from"./index-ZajWnxG1.js";import{Q as H,b as O,a as J}from"./format-B8DKuPGh.js";import{Q as C}from"./QTooltip-D4R9T5Fc.js";import{a as A}from"./QTable-CXYRITav.js";import{Q as K,a as E,b as M,c as I,d as W,e as X}from"./QTabPanels-HGFJe3oi.js";import{Q as $}from"./QPopupProxy-D0Ly69kw.js";import{Q as ee,a as R}from"./QFab-CHynsvqb.js";import{T as le}from"./TouchPan-B1-PqlLb.js";import{C as q}from"./ClosePopup-LSrQ-VjT.js";import{c as t}from"./Index-2Zuzj8Ve.js";import"./QResizeObserver-CqC5UUgk.js";import"./QSpace-CfwQ6zIi.js";import"./QInnerLoading-DKttGab9.js";import"./QSpinnerGears-BOF8vRdR.js";let a;const ae={props:["parameters"],emits:["close"],components:{Pick:U(()=>S(()=>import("./Pick-CYwS7Ngw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Table3:U(()=>S(()=>import("./Table3-DaxbvJfy.js"),__vite__mapDeps([12,1,2,3,4,7,5,6,9,10,11])))},setup(){return{crud:t,id:u(null),is_edit:u(!1),saving:u(!1),index:u(null),fields:u(null),template:u({options:{}}),definition:u({}),parentRow:u(null),row:u(null),replica:u(null),relations:u([]),enums:u({}),options:u({}),loading:u({}),dialog:u({main:t.dialog.init(()=>a.dialog.main),pick:t.dialog.init(),table:t.dialog.init()})}},created(){a=this,a.fields=[],a.is_edit=!1;let o=t.get.object(a.parameters);a.replica=t.get.number(o.replica,null),a.template=t.get.object(o.template),a.definition=t.get.object(o.definition),a.parentRow=t.get.object(o.parentRow),a.relations=t.get.array(o.relations),a.enums={},t.isObject(a.template.enums)&&Object.keys(a.template.enums).forEach(d=>{a.enums[d]=[null].concat(a.template.enums[d])}),a.options={},t.isObject(a.template.options)&&Object.keys(a.template.options).forEach(d=>{a.options[d]=[null].concat(a.template.options[d])}),a.row=t.get.object(o.row);let r=t.get.array(a.definition?.fields);if(r.length){if(t.isObject(o.row)){a.index=o.index,a.id=t.id.fromPk(a.definition.id,o.row._pk_),a.is_edit=t.isDefined(a.id);for(const d of r){let e=t.clone.field(d);e.value=t.getFieldValue(e.name,o.row),!t.isDefined(e.value)&&t.isFunction(e.rowToValue)&&(e.value=e.rowToValue(o.row)),e.type==="datetime"&&e.converter==="epoch"?e.value=t.format.date(e.value,{format:e.pattern||null}):e.type==="pick"&&(t.isDefined(e.value)&&e.value!==null?e.text=t.isFunction(e.format)?e.format(e.value,o.row):e.value+"":e.text=t.isFunction(e.format)?e.format(null,o.row):""),a.is_edit||(e.editable=e.insertable),a.fields.push(e)}}else for(const d of r)if(d.insertable){let e=t.clone.field(d);e.editable=e.insertable,a.fields.push(e)}}},methods:{on_table_click(o){let r=t.get.object(a.parameters),d=t.get.object(r.template),e=t.get.object(r.row),b=t.copy(t.get.array(o.relations));if(!b.length){t.error("error.required","label.relation");return}for(const p of b)p.value=t.getFieldValue(p.source,e);o._grid_id_=d._grid_id_,t.dialog.show(a.dialog.table,{template:d,definition:o,parentRow:e,relations:b,onlyView:!1,replica:a.replica})},on_close_dialog_table(){t.dialog.hide(a.dialog.table)},on_pick_select_click(o){let r=a.template.picks[o.pick];if(!t.isObject(r)){t.error("error.required","label.pick");return}let d=t.isArray(r.relations)?r.relations:[];for(const e of d)if(e.value=t.getFieldValue(e.source,a.parentRow),!t.isDefined(e.value)){let b=a.fields.find(p=>p.name===e.source);t.runIf(t.isObject(b),()=>{e.value=t.isFunction(b.toValue)?b.toValue(b.value):b.value,e.value=t.isObject(e.value)?e.value[e.source]:e.value})}t.dialog.show(a.dialog.pick,{template:a.template,field:o,pick:r,relations:d,replica:a.replica})},on_pick_remove_click(o){o.value=void 0,o.text=void 0},on_close_dialog_pick(o){if(o?._pk_){let r=a.dialog.pick.parameters.field,d=t.isFunction(r.format)?r.format(o):o+"";r.value=o,r.text=d}t.dialog.hide(a.dialog.pick)},on_clone_click(){let o=a.row?t.copy(a.row):null;if(o?._pk_){delete o._pk_;let r=a.template.id;r.type==="STANDARD"&&delete o[r.fields[0]]}a.$emit("close",{row:o,is_edit:a.is_edit})},on_save_click(){t.action.save({id:a.id,fields:a.fields,definition:a.definition,replica:a.replica,is_edit:a.is_edit,saving:a.saving,relations:a.relations,index:a.index,row:a.row,emit:a.$emit})}}},te={class:"bg-primary"},oe={class:"q-pa-xs bg-white row"},ne={class:"col-6 text-left"},ie={class:"col-6 text-right"},se={key:0,class:"q-mb-xs",style:{width:"100%"}},re={class:"col-4 q-pr-xs text-left"},de={class:"col-4 q-pr-xs text-center"},ce={class:"col-4 q-pl-xs text-right"};function ue(o,r,d,e,b,p){const B=j("Pick"),N=j("Table3");return c(),k(x,null,[i(Z,{style:D("width: "+(o.$q.screen.lt.md?"100%;":"50%;")+e.dialog.main.style)},{default:s(()=>[V((c(),m(T,{class:"q-pa-none header-main",style:D(e.crud.config?.color?.header?"background: "+e.crud.config.color.header+" !important;":"")},{default:s(()=>[i(H,{class:"q-pr-none"},{default:s(()=>[i(O,null,{default:s(()=>[i(J,{class:"text-h6 text-white"},{default:s(()=>[f(y(e.definition.title+" - "+(e.is_edit?o.$t("label.edit"):o.$t("label.new"))),1)]),_:1})]),_:1}),i(O,{side:""},{default:s(()=>[i(g,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:e.saving,onClick:r[0]||(r[0]=l=>o.$emit("close"))},{default:s(()=>[i(C,null,{default:s(()=>[f(y(o.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])]),_:1})]),_:1})]),_:1},8,["style"])),[[le,e.dialog.main.onDrag,void 0,{mouse:!0}]]),i(T,{style:{"max-height":"65vh"},class:"q-pa-xs q-mt-xs scroll"},{default:s(()=>[(c(!0),k(x,null,P(e.fields,(l,w)=>(c(),k("div",{key:w,class:"q-mb-xs",style:{width:"100%"}},[l.type==="words"?(c(),m(h,{key:0,type:"text",label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):l.type==="option"?(c(),m(A,{key:1,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,label:l.label,readonly:!l.editable,options:e.options[l.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},{"selected-item":s(n=>[f(y(n.opt?.label||e.options[l.option][n.opt]?.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label","readonly","options"])):l.type==="enum"?(c(),m(A,{key:2,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,label:l.label,readonly:!l.editable,options:e.enums[l.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},{"selected-item":s(n=>[f(y(n.opt?.label||e.enums[l.enum][n.opt]?.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label","readonly","options"])):l.type==="datetime"||l.type==="date"||l.type==="time"?(c(),m(h,{key:3,type:"text",label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,filled:""},{append:s(()=>[i(z,{name:l.type==="time"?"schedule":l.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:s(()=>[i($,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:n=>e.crud.calendar.beforeShow(l,"tab","proxy_value","value")},{default:s(()=>[_("div",te,[i(K,{modelValue:l.tab,"onUpdate:modelValue":n=>l.tab=n,class:"bg-primary text-grey-5 shadow-2 text-subtitle2","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:s(()=>[l.type==="datetime"||l.type==="date"?(c(),m(E,{key:0,name:"date"},{default:s(()=>[_("span",null,y(o.$t("label.date")),1)]),_:1})):v("",!0),l.type==="datetime"||l.type==="time"?(c(),m(E,{key:1,name:"time"},{default:s(()=>[_("span",null,y(o.$t("label.time")),1)]),_:1})):v("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),i(Q),i(M,{modelValue:l.tab,"onUpdate:modelValue":n=>l.tab=n},{default:s(()=>[l.type==="datetime"||l.type==="date"?(c(),m(I,{key:0,name:"date",class:"q-pa-none"},{default:s(()=>[i(W,{modelValue:l.proxy_value,"onUpdate:modelValue":n=>l.proxy_value=n,mask:l.pattern,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):v("",!0),l.type==="datetime"||l.type==="time"?(c(),m(I,{key:1,name:"time",class:"q-pa-none"},{default:s(()=>[i(X,{modelValue:l.proxy_value,"onUpdate:modelValue":n=>l.proxy_value=n,mask:l.pattern,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):v("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),i(Q),_("div",oe,[_("div",ne,[V(i(g,{label:o.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[q]])]),_("div",ie,[V(i(g,{label:o.$t("label.ok"),color:"secondary","no-caps":"",onClick:n=>l.value=l.proxy_value},null,8,["label","onClick"]),[[q]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):l.type==="pick"?(c(),m(h,{key:4,type:"text",label:l.label,readonly:!l.editable,modelValue:l.text,"onUpdate:modelValue":n=>l.text=n,filled:"",autogrow:""},G({_:2},[l.editable?{name:"append",fn:s(()=>[i(ee,{modelValue:l.fab,"onUpdate:modelValue":n=>l.fab=n,icon:"flaky",direction:"left",padding:"none",round:"",dense:"",flat:"",glossy:"",class:"q-ma-none q-pa-none"},{default:s(()=>[i(R,{color:"secondary",icon:"fact_check",round:"",dense:"",glossy:"",onClick:n=>p.on_pick_select_click(l)},{default:s(()=>[i(C,null,{default:s(()=>[f(y(o.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),l.value?(c(),m(R,{key:0,color:"negative",icon:"delete_forever",round:"",dense:"",glossy:"",onClick:n=>p.on_pick_remove_click(l)},{default:s(()=>[i(C,null,{default:s(()=>[f(y(o.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):v("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(c(),m(h,{key:5,type:l.type,label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128)),e.is_edit&&e.definition.children?.length?(c(),k("div",se,[(c(!0),k(x,null,P(e.definition.children,(l,w)=>(c(),m(g,{key:w,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:n=>p.on_table_click(l)},null,8,["label","onClick"]))),128))])):v("",!0)]),_:1}),i(Q),i(Y,{class:"row"},{default:s(()=>[_("div",re,[V(i(g,{label:o.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:e.saving},null,8,["label","disable"]),[[q]])]),_("div",de,[e.is_edit&&e.definition.copy!==!1&&e.crud.permission.add(e.template)?(c(),m(g,{key:0,label:o.$t("label.copy"),color:"purple","no-caps":"",glossy:"",disable:e.saving,onClick:p.on_clone_click},null,8,["label","disable","onClick"])):v("",!0)]),_("div",ce,[i(g,{label:o.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:e.saving,onClick:p.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),i(F,{modelValue:e.dialog.pick.show,"onUpdate:modelValue":r[1]||(r[1]=l=>e.dialog.pick.show=l),persistent:"","transition-show":"slide-down","transition-hide":"slide-down","backdrop-filter":"blur(1px)"},{default:s(()=>[i(B,{parameters:e.dialog.pick.parameters,onClose:p.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"]),i(F,{modelValue:e.dialog.table.show,"onUpdate:modelValue":r[2]||(r[2]=l=>e.dialog.table.show=l),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)","full-height":""},{default:s(()=>[i(N,{parameters:e.dialog.table.parameters,onClose:p.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const Ce=L(ae,[["render",ue]]);export{Ce as default};
