const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TableView-CPalv4dR.js","assets/format-B8DKuPGh.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/QTooltip-D4R9T5Fc.js","assets/ClosePopup-LSrQ-VjT.js"])))=>i.map(i=>d[i]);
import{_ as O,ag as R,Y as Q,a7 as C,$ as m,a9 as w,f as n,a0 as l,ai as S,Z as p,a2 as k,a3 as f,a4 as u,a5 as d,ah as N,F as z,a8 as P,C as V,a1 as $,al as H,ac as y,af as _,ae as o,r as h,am as M}from"./index-ZajWnxG1.js";import{Q as b}from"./QTooltip-D4R9T5Fc.js";import{Q as T}from"./QTable-CXYRITav.js";import{Q as E,b as B,a as v,e as J}from"./format-B8DKuPGh.js";import{T as A}from"./TouchPan-B1-PqlLb.js";let e;const D={components:{View:R(()=>M(()=>import("./TableView-CPalv4dR.js"),__vite__mapDeps([0,1,2,3,4,5])))},setup(){return{util:o,handler:h(null),running:h(null),metadata:h([]),groups:h({}),columns:h([]),visibles:h([]),filter:h({}),expand:h({}),pagination:h({}),loading:h({start_stop:!1,metadata:!1,group:{},pause_resume:{},schedule_unschedule:{},trigger:{}}),dialog:h({view:y.dialog.init(()=>e.dialog.view)})}},created(){e=this,e.visibles=["name","cronExpression","type.isRunning","isLocking","lastRunTime","status.startTime","status.previousFireTime","status.nextFireTime"],e.columns=[{name:"name",label:e.$t("label.name"),field:"name",align:"left",sortable:!0},{name:"cronExpression",label:e.$t("label.cron"),field:"cronExpression",align:"left",sortable:!0},{name:"type.classname",label:e.$t("label.class"),field:"type",align:"left",format:function(a){return a?a.classname:a.name}},{name:"isRunOnStartup",label:e.$t("label.run_on_startup"),field:"isRunOnStartup",align:"center",format:function(a){return a==="Y"?e.$t("label.yes"):a==="N"?e.$t("label.no"):""}},{name:"type.isRunning",label:e.$t("label.running"),field:"type",align:"center",sortable:!0,format:a=>{let t=a?.isSingleRun,i=a?.isRunning;return t==="Y"&&i=="Y"?e.$t("label.yes"):e.$t("label.no")}},{name:"isLocking",label:e.$t("label.locking"),field:"isLocking",align:"center",sortable:!0,format:function(a){return a==="Y"?e.$t("label.yes"):e.$t("label.no")}},{name:"lastRunTime",label:e.$t("label.last_run_time"),field:"lastRunTime",align:"center",sortable:!0,format:function(a){return a&&o.isNumber(a)?o.format.date(a,{format:"yyyy-MM-dd HH:mm:ss"}):""}},{name:"status.startTime",label:e.$t("label.start_time"),field:"status",align:"center",format:function(a){return a&&o.isNumber(a.startTime)?o.format.date(a.startTime,{format:"yyyy-MM-dd HH:mm:ss"}):""}},{name:"status.previousFireTime",label:e.$t("label.previous_fire_time"),field:"status",align:"center",format:function(a){return a&&o.isNumber(a.previousFireTime)?o.format.date(a.previousFireTime,{format:"yyyy-MM-dd HH:mm:ss"}):""}},{name:"status.nextFireTime",label:e.$t("label.next_fire_time"),field:"status",align:"center",format:function(a){return a&&o.isNumber(a.nextFireTime)?o.format.date(a.nextFireTime,{format:"yyyy-MM-dd HH:mm:ss"}):""}},{name:"status.state",label:e.$t("label.state"),field:"status",align:"center",format:function(a){return a?a.state:""}},{name:"status.priority",label:e.$t("label.priority"),field:"status",align:"center",format:function(a){return a&&o.isNumber(a.priority)?a.priority:""}},{name:"trigger",label:e.$t("label.trigger"),field:"trigger",align:"left"},{name:"type",label:e.$t("label.type"),field:"type",align:"left"},{name:"status",label:e.$t("label.status"),field:"status",align:"left"}],e.do_init()},methods:{do_init(){let a=e.$route.query.handler;a!==e.handler&&(e.handler=a,e.get_metadata(),e.get_groups())},get_metadata(){e.loading.metadata=!0,_.call({path:"/scheduler/metadata",params:{handler:e.handler},onFinish(){e.loading.metadata=!1},onSuccess(a,t){e.running=t.running,e.metadata=[],o.isObject(a)&&Object.keys(a).forEach(i=>{e.metadata.push({label:i.substring(0,1).toUpperCase()+i.substring(1),value:i==="runningSince"?o.format.date(a[i],{format:"yyyy-MM-dd HH:mm:ss"}):a[i]})}),o.isArray(t.packages)&&e.metadata.push({label:"JobPackages",value:JSON.stringify(t.packages)})}})},init_group(a,t,i){e.groups[a.groupId]=a,e.loading.group[a.groupId]=!1,e.filter[a.groupId]=i[a.groupId]?i[a.groupId]:null,e.expand[a.groupId]=t[a.groupId]===!0,e.pagination[a.groupId]={page:1,rowsPerPage:10,sortBy:"name",descending:!1,triggers:[],groupId:a.groupId}},get_groups(){_.call({path:"/scheduler/groups",params:{handler:e.handler,size:1e3,order:"name"},onSuccess(a){if(o.isArray(a?.data)){let t=JSON.parse(JSON.stringify(e.expand)),i=JSON.parse(JSON.stringify(e.filter));e.groups={},e.expand={},e.filter={},e.pagination={};for(const r of a.data)e.init_group(r,t,i),e.refresh_triggers(r.groupId)}}})},refresh_triggers(a){e.pagination[a].page=1,e.get_triggers(a)},get_triggers(a){let t=e.pagination[a];e.loading.group[a]=!0,_.call({path:"/scheduler/triggers",params:{handler:e.handler,groupId:a,index:t.page,size:t.rowsPerPage,order:(t.descending?"-":"")+t.sortBy},onFinish(){e.loading.group[a]=!1},onSuccess(i){let r=e.pagination[a];if(o.isObject(i))if(r.triggers=o.isArray(i.data)?i.data:[],r.page=i.index,r.rowsPerPage=i.size,o.isNumber(i.records))r.rowsNumber=i.records;else{let x=i.index*i.size;r.triggers.length!==i.size?r.rowsNumber=x:r.rowsNumber=x+1}}})},on_table_request(a){e.pagination[a.pagination.groupId]=a.pagination,e.get_triggers(a.pagination.groupId)},on_start_stop_click(){y.confirm(function(){e.loading.start_stop=!0,_.call({path:"/scheduler/"+(e.running?"stop":"start"),method:"post",params:{handler:e.handler},onFinish(){e.loading.start_stop=!1},onSuccess(){e.get_metadata(),e.get_groups()}})},e.$t("label."+(e.running?"stop":"start"))+" ?")},on_pause_click(a){let t=a.row;y.confirm(function(){e.loading.pause_resume[t.triggerId]=!0,_.call({path:"/scheduler/pause",method:"post",params:{handler:e.handler,triggerId:t.triggerId},onFinish(){e.loading.pause_resume[t.triggerId]=!1},onSuccess(){e.get_triggers(t.groupId)}})},e.$t("label.pause")+" <b>"+t.name+"</b> ?")},on_resume_click(a){let t=a.row;y.confirm(function(){e.loading.pause_resume[t.triggerId]=!0,_.call({path:"/scheduler/resume",method:"post",params:{handler:e.handler,triggerId:t.triggerId},onFinish(){e.loading.pause_resume[t.triggerId]=!1},onSuccess(){e.get_triggers(t.groupId)}})},e.$t("label.resume")+" <b>"+t.name+"</b> ?")},on_schedule_click(a){let t=a.row;y.confirm(function(){e.loading.schedule_unschedule[t.triggerId]=!0,_.call({path:"/scheduler/add",method:"post",params:{handler:e.handler,triggerId:t.triggerId},onFinish(){e.loading.schedule_unschedule[t.triggerId]=!1},onSuccess(){e.get_triggers(t.groupId)}})},e.$t("label.schedule")+" <b>"+t.name+"</b> ?")},on_unschedule_click(a){let t=a.row;y.confirm(function(){e.loading.schedule_unschedule[t.triggerId]=!0,_.call({path:"/scheduler/delete",method:"post",params:{handler:e.handler,triggerId:t.triggerId},onFinish(){e.loading.schedule_unschedule[t.triggerId]=!1},onSuccess(){e.get_triggers(t.groupId)}})},e.$t("label.unschedule")+" <b>"+t.name+"</b> ?")},on_trigger_click(a){let t=a.row;y.confirm(function(){e.loading.trigger[t.triggerId]=!0,_.call({path:"/scheduler/trigger",method:"post",params:{handler:e.handler,triggerId:t.triggerId},onFinish(){e.loading.trigger[t.triggerId]=!1},onSuccess(){e.get_triggers(t.groupId)}})},e.$t("label.trigger")+" <b>"+t.name+"</b> ?")},on_view_click(a){delete a.row.trigger;let t=JSON.parse(JSON.stringify(a.row));delete t.type,delete t.status,a.row.trigger=t,y.dialog.show(e.dialog.view,{scope:a,columns:e.columns})},on_reset_running_click(){y.confirm(function(){_.call({path:"/scheduler/reset/running",method:"post",params:{handler:e.handler}})},e.$t("label.reset_running")+" ?")},on_reset_locking_click(){y.confirm(function(){_.call({path:"/scheduler/reset/locking",method:"post",params:{handler:e.handler}})},e.$t("label.reset_locking")+" ?")}}},L={class:"q-mt-none q-pa-sm q-mb-lg"},U={class:"col-md-3 col-xs-12 text-center flex flex-center",style:{"border-right":"solid 0.5px"}},Y={class:"col-md-9 col-xs-12"},j={class:"row"},Z={class:"col-6 text-right"},G={class:"col-6 text-right"},K={class:"text-right"};function W(a,t,i,r,x,c){const F=Q("View");return m(),C(z,null,[w("div",L,[n(N,{class:"q-pa-none q-mb-lg",bordered:""},{default:l(()=>[n(S,{class:"row q-pa-none"},{default:l(()=>[w("div",U,[r.running!==null?(m(),p(f,{key:0,round:"",glossy:"",class:"q-mb-sm q-mt-sm",icon:r.running?"stop_circle":"play_circle",color:r.running?"negative":"positive",size:"5vh",loading:r.loading.start_stop,onClick:c.on_start_stop_click},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t(r.running?"label.stop":"label.start")),1)]),_:1})]),_:1},8,["icon","color","loading","onClick"])):k("",!0)]),w("div",Y,[w("div",j,[w("div",Z,[n(f,{round:"",glossy:"",dense:"",size:"sm",icon:"layers_clear_24",color:"teal-9",class:"q-ma-xs",onClick:c.on_reset_running_click},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.reset_running")),1)]),_:1})]),_:1},8,["onClick"]),n(f,{round:"",glossy:"",dense:"",size:"sm",icon:"developer_board_off_24",color:"indigo-9",class:"q-ma-xs q-ml-sm",onClick:c.on_reset_locking_click},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.reset_locking")),1)]),_:1})]),_:1},8,["onClick"])]),w("div",G,[n(f,{round:"",glossy:"",dense:"",size:"sm",icon:"refresh",class:"q-ma-xs",loading:r.loading.metadata,onClick:c.get_metadata},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.refresh")),1)]),_:1})]),_:1},8,["loading","onClick"])])]),r.metadata?.length?(m(),p(T,{key:0,class:"table-sticky-header no-column q-ma-xs",style:{"max-height":"25vh"},rows:r.metadata,separator:"horizontal","rows-per-page-options":[0],"hide-bottom":"","hide-header":"",dense:"",flat:"",bordered:""},null,8,["rows"])):k("",!0)])]),_:1})]),_:1}),(m(!0),C(z,null,P(r.groups,(I,g)=>(m(),p(N,{key:g,class:"q-pa-none q-mb-lg",bordered:""},{default:l(()=>[n(E,null,{default:l(()=>[n(B,null,{default:l(()=>[n(v,{class:"text-h5"},{default:l(()=>[u(d(I.name),1)]),_:2},1024),n(v,{class:"text-italic",caption:""},{default:l(()=>[u(d(a.$t("label.zone_offset_seconds"))+": "+d(I.zoneOffsetSeconds),1)]),_:2},1024),n(v,{class:"ellipsis-text lines2",caption:""},{default:l(()=>[u(d(I.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),r.expand[g]?(m(),p(S,{key:0,class:"q-pa-xs"},{default:l(()=>[n(T,{class:"table-sticky-header",rows:r.pagination[g].triggers,"visible-columns":r.visibles,columns:r.columns,"row-key":"triggerId",loading:r.loading[g],pagination:r.pagination[g],"onUpdate:pagination":s=>r.pagination[g]=s,filter:r.filter[g],"binary-state-sort":"",separator:"cell",selection:"single","rows-per-page-label":" ","rows-per-page-options":[10,20,30,40,50],onRequest:c.on_table_request},{"body-selection":l(s=>[w("div",K,[s.row?.status?.state&&s.row.status.state==="PAUSED"?(m(),p(f,{key:0,glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"green-9",icon:"play_arrow",loading:r.loading.pause_resume[s.row.triggerId],onClick:q=>c.on_resume_click(s)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.resume")),1)]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),s.row?.status?.state&&s.row.status.state!=="PAUSED"?(m(),p(f,{key:1,glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"orange-9",icon:"pause",loading:r.loading.pause_resume[s.row.triggerId],onClick:q=>c.on_pause_click(s)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.pause")),1)]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),s.row?.status&&s.row.status.scheduled!==!0?(m(),p(f,{key:2,glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"indigo-9",icon:"add",loading:r.loading.schedule_unschedule[s.row.triggerId],onClick:q=>c.on_schedule_click(s)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.schedule")),1)]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),s.row?.status&&s.row.status.scheduled===!0?(m(),p(f,{key:3,glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"pink-9",icon:"remove",loading:r.loading.schedule_unschedule[s.row.triggerId],onClick:q=>c.on_unschedule_click(s)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.unschedule")),1)]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),s.row?.status&&s.row.status.scheduled===!0?(m(),p(f,{key:4,glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"blue-grey-9",icon:"directions_run",loading:r.loading.trigger[s.row.triggerId],onClick:q=>c.on_trigger_click(s)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.trigger")),1)]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),n(f,{glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"deep-purple",icon:"visibility",onClick:q=>c.on_view_click(s)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.view")),1)]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["rows","visible-columns","columns","loading","pagination","onUpdate:pagination","filter","onRequest"])]),_:2},1024)):k("",!0),n(J,{color:"transparent",floating:"",transparent:""},{default:l(()=>[r.expand[g]?(m(),p(f,{key:0,round:"",glossy:"",dense:"",size:"sm",icon:"refresh",class:"q-ma-sm button-default",loading:r.loading.group[g],onClick:s=>c.refresh_triggers(g)},{default:l(()=>[n(b,null,{default:l(()=>[u(d(a.$t("label.refresh")),1)]),_:1})]),_:2},1032,["loading","onClick"])):k("",!0),n(f,{round:"",glossy:"",dense:"",size:"sm",class:"q-ma-sm button-default",icon:r.expand[g]?"keyboard_arrow_up":"keyboard_arrow_down",onClick:s=>r.expand[g]=!r.expand[g]},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024))),128))]),n(H,{modelValue:r.dialog.view.show,"onUpdate:modelValue":t[0]||(t[0]=I=>r.dialog.view.show=I),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:l(()=>[V(n(F,{parameters:r.dialog.view.parameters,style:$(r.dialog.view.style)},null,8,["parameters","style"]),[[A,r.dialog.view.onDrag,void 0,{mouse:!0}]])]),_:1},8,["modelValue"])],64)}const le=O(D,[["render",W]]);export{le as default};
