const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-CYwS7Ngw.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/format-B8DKuPGh.js","assets/QTooltip-D4R9T5Fc.js","assets/QSpace-CfwQ6zIi.js","assets/QInnerLoading-DKttGab9.js","assets/QTable-CXYRITav.js","assets/ClosePopup-LSrQ-VjT.js","assets/TouchPan-B1-PqlLb.js","assets/Index-2Zuzj8Ve.js","assets/QSpinnerGears-BOF8vRdR.js","assets/Table1-BawP0C-N.js","assets/FormE-DWx3jrj4.js","assets/QTabPanels-HGFJe3oi.js","assets/QResizeObserver-CqC5UUgk.js","assets/QPopupProxy-D0Ly69kw.js","assets/QFab-CHynsvqb.js"])))=>i.map(i=>d[i]);
import{_ as G,ag as U,Y as j,a7 as b,$ as r,f as n,a0 as d,C as q,Z as u,ai as A,a1 as S,a4 as V,a5 as w,a3 as f,F as x,a8 as C,aj as Q,G as z,a9 as h,a2 as k,Q as F,an as Y,ak as Z,ah as H,al as T,r as y,am as D}from"./index-ZajWnxG1.js";import{Q as J,b as O,a as K}from"./format-B8DKuPGh.js";import{Q as E}from"./QTooltip-D4R9T5Fc.js";import{a as I}from"./QTable-CXYRITav.js";import{Q as M,a as B,b as W,c as L,d as X,e as $}from"./QTabPanels-HGFJe3oi.js";import{Q as ee}from"./QPopupProxy-D0Ly69kw.js";import{Q as le,a as N}from"./QFab-CHynsvqb.js";import{T as ae}from"./TouchPan-B1-PqlLb.js";import{C as P}from"./ClosePopup-LSrQ-VjT.js";import{c as t}from"./Index-2Zuzj8Ve.js";import"./QResizeObserver-CqC5UUgk.js";import"./QSpace-CfwQ6zIi.js";import"./QInnerLoading-DKttGab9.js";import"./QSpinnerGears-BOF8vRdR.js";let a;const te={props:["parameters"],emits:["close"],components:{Pick:U(()=>D(()=>import("./Pick-CYwS7Ngw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Table1:U(()=>D(()=>import("./Table1-BawP0C-N.js"),__vite__mapDeps([12,1,2,3,4,7,5,6,9,10,11]))),FormE:U(()=>D(()=>import("./FormE-DWx3jrj4.js"),__vite__mapDeps([13,1,2,3,4,7,14,15,9,16,17,8,10,5,6,11])))},setup(){return{crud:t,id:y(null),is_edit:y(!1),saving:y(!1),index:y(null),fields:y(null),template:y({options:{}}),row:y(null),replica:y(null),enums:y({}),options:y({}),loading:y({}),dialog:y({main:t.dialog.init(()=>a.dialog.main),form:t.dialog.init(),pick:t.dialog.init(),table:t.dialog.init()})}},created(){a=this,a.fields=[],a.is_edit=!1;let o=t.get.object(a.parameters);a.replica=t.get.number(o.replica,null),a.template=t.get.object(o.template),a.enums={},t.isObject(a.template.enums)&&Object.keys(a.template.enums).forEach(c=>{a.enums[c]=[null].concat(a.template.enums[c])}),a.options={},t.isObject(a.template.options)&&Object.keys(a.template.options).forEach(c=>{a.options[c]=[null].concat(a.template.options[c])}),a.row=t.get.object(o.row);let s=t.get.array(a.template.fields);if(s.length){if(t.isObject(o.row)){a.index=o.index,a.id=t.id.fromPk(a.template.id,o.row._pk_),a.is_edit=t.isDefined(a.id);for(const c of s){let e=t.clone.field(c);e.value=t.getFieldValue(e.name,o.row),!t.isDefined(e.value)&&t.isFunction(e.rowToValue)&&(e.value=e.rowToValue(o.row)),e.type==="datetime"&&e.converter==="epoch"?e.value=t.format.date(e.value,{format:e.pattern||null}):e.type==="pick"&&(t.isDefined(e.value)&&e.value!==null?e.text=t.isFunction(e.format)?e.format(e.value,o.row):e.value+"":e.text=t.isFunction(e.format)?e.format(null,o.row):""),a.is_edit||(e.editable=e.insertable),a.fields.push(e)}}else for(const c of s)if(c.insertable){let e=t.clone.field(c);e.editable=e.insertable,a.fields.push(e)}}},methods:{on_form_click(o,s){let c=t.get.object(a.parameters),e=t.get.object(c.row),p=t.get.array(o.relations);if(!p.length){t.error("error.required","label.relation");return}let m=[];for(const g of p)g.value=t.getFieldValue(g.source,e),m.push({field:g.target,condition:"EQUAL",value:g.value});let v=t.copy(o.crud);v.filters=t.isArray(v.filters)?v.filters:[],v.filters=v.filters.concat(m),t.isNumber(a.replica)&&(v.replica=a.replica),a.loading["form_"+s]=!0,t.api.call({path:"/crud/single",method:"post",data:v,onFinish(){a.loading["form_"+s]=!1},onSuccess(g){g=t.get.object(g),t.inject.pkAndGridId(o.id,g,a.template._grid_id_),t.dialog.show(a.dialog.form,{form:o,template:a.template,row:e,data:g,replica:a.replica,relations:p,is_edit:t.isDefined(g._pk_)})}})},on_close_dialog_form(){t.dialog.hide(a.dialog.form)},on_pick_select_click(o){let s=a.template.picks[o.pick];if(!t.isObject(s)){t.error("error.required","label.pick");return}let c=t.isArray(s.relations)?s.relations:[];for(const e of c)if(e.value=t.getFieldValue(e.source,a.row),!t.isDefined(e.value)){let p=a.fields.find(m=>m.name===e.source);t.runIf(t.isObject(p),()=>{e.value=t.isFunction(p.toValue)?p.toValue(p.value):p.value,e.value=t.isObject(e.value)?e.value[e.source]:e.value})}t.dialog.show(a.dialog.pick,{template:a.template,field:o,pick:s,relations:c,replica:a.replica})},on_pick_remove_click(o){o.value=void 0,o.text=void 0},on_close_dialog_pick(o){if(o?._pk_){let s=a.dialog.pick.parameters.field,c=t.isFunction(s.format)?s.format(o):o+"";s.value=o,s.text=c}t.dialog.hide(a.dialog.pick)},on_table_click(o){let s=t.get.object(a.parameters),c=t.get.object(s.template),e=t.get.object(s.row),p=t.copy(t.get.array(o.relations));if(!p.length){t.error("error.required","label.relation");return}for(const m of p)m.value=t.getFieldValue(m.source,e);o._grid_id_=c._grid_id_,t.dialog.show(a.dialog.table,{template:c,definition:o,parentRow:e,relations:p,onlyView:!1,replica:a.replica})},on_close_dialog_table(){t.dialog.hide(a.dialog.table)},on_clone_click(){let o=a.row?t.copy(a.row):null;if(o?._pk_){delete o._pk_;let s=a.template.id;s.type==="STANDARD"&&delete o[s.fields[0]]}a.$emit("close",{row:o,is_edit:a.is_edit})},on_save_click(){t.action.save({id:a.id,fields:a.fields,definition:a.template,replica:a.replica,is_edit:a.is_edit,saving:a.saving,index:a.index,row:a.row,emit:a.$emit})}}},oe={class:"bg-primary"},ie={class:"q-pa-xs bg-white row"},ne={class:"col-6 text-left"},se={class:"col-6 text-right"},re={key:0},de={key:0,class:"q-mb-xs",style:{width:"100%"}},ce={key:1,class:"q-mb-xs",style:{width:"100%"}},me={key:1},ue={key:0,class:"q-mb-xs",style:{width:"100%"}},pe={key:1,class:"q-mb-xs",style:{width:"100%"}},_e={class:"col-4 q-pr-xs text-left"},be={class:"col-4 q-pr-xs text-center"},ge={class:"col-4 q-pl-xs text-right"};function ye(o,s,c,e,p,m){const v=j("Pick"),g=j("Table1"),R=j("FormE");return r(),b(x,null,[n(H,{style:S("width: "+(o.$q.screen.lt.md?"100%;":"50%;")+e.dialog.main.style)},{default:d(()=>[q((r(),u(A,{class:"q-pa-none header-main",style:S(e.crud.config?.color?.header?"background: "+e.crud.config.color.header+" !important;":"")},{default:d(()=>[n(J,{class:"q-pr-none"},{default:d(()=>[n(O,null,{default:d(()=>[n(K,{class:"text-h6 text-white"},{default:d(()=>[V(w(e.is_edit?o.$t("label.edit"):o.$t("label.new")),1)]),_:1})]),_:1}),n(O,{side:""},{default:d(()=>[n(f,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:e.saving,onClick:s[0]||(s[0]=l=>o.$emit("close"))},{default:d(()=>[n(E,null,{default:d(()=>[V(w(o.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])]),_:1})]),_:1})]),_:1},8,["style"])),[[ae,e.dialog.main.onDrag,void 0,{mouse:!0}]]),n(A,{style:{"max-height":"65vh"},class:"q-pa-xs q-mt-xs scroll"},{default:d(()=>[(r(!0),b(x,null,C(e.fields,(l,_)=>(r(),b("div",{key:_,class:"q-mb-xs",style:{width:"100%"}},[l.type==="words"?(r(),u(Q,{key:0,type:"text",label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):l.type==="option"?(r(),u(I,{key:1,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,label:l.label,readonly:!l.editable,options:e.options[l.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},{"selected-item":d(i=>[V(w(i.opt?.label||e.options[l.option][i.opt]?.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label","readonly","options"])):l.type==="enum"?(r(),u(I,{key:2,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,label:l.label,readonly:!l.editable,options:e.enums[l.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},{"selected-item":d(i=>[V(w(i.opt?.label||e.enums[l.enum][i.opt]?.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label","readonly","options"])):l.type==="datetime"||l.type==="date"||l.type==="time"?(r(),u(Q,{key:3,type:"text",label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,filled:""},{append:d(()=>[n(z,{name:l.type==="time"?"schedule":l.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:d(()=>[n(ee,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:i=>e.crud.calendar.beforeShow(l,"tab","proxy_value","value")},{default:d(()=>[h("div",oe,[n(M,{modelValue:l.tab,"onUpdate:modelValue":i=>l.tab=i,class:"bg-primary text-grey-5 shadow-2 text-subtitle2","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:d(()=>[l.type==="datetime"||l.type==="date"?(r(),u(B,{key:0,name:"date"},{default:d(()=>[h("span",null,w(o.$t("label.date")),1)]),_:1})):k("",!0),l.type==="datetime"||l.type==="time"?(r(),u(B,{key:1,name:"time"},{default:d(()=>[h("span",null,w(o.$t("label.time")),1)]),_:1})):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),n(F),n(W,{modelValue:l.tab,"onUpdate:modelValue":i=>l.tab=i},{default:d(()=>[l.type==="datetime"||l.type==="date"?(r(),u(L,{key:0,name:"date",class:"q-pa-none"},{default:d(()=>[n(X,{modelValue:l.proxy_value,"onUpdate:modelValue":i=>l.proxy_value=i,mask:l.pattern,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):k("",!0),l.type==="datetime"||l.type==="time"?(r(),u(L,{key:1,name:"time",class:"q-pa-none"},{default:d(()=>[n($,{modelValue:l.proxy_value,"onUpdate:modelValue":i=>l.proxy_value=i,mask:l.pattern,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),n(F),h("div",ie,[h("div",ne,[q(n(f,{label:o.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[P]])]),h("div",se,[q(n(f,{label:o.$t("label.ok"),color:"secondary","no-caps":"",onClick:i=>l.value=l.proxy_value},null,8,["label","onClick"]),[[P]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):l.type==="pick"?(r(),u(Q,{key:4,type:"text",label:l.label,readonly:!l.editable,modelValue:l.text,"onUpdate:modelValue":i=>l.text=i,filled:"",autogrow:""},Y({_:2},[l.editable?{name:"append",fn:d(()=>[n(le,{modelValue:l.fab,"onUpdate:modelValue":i=>l.fab=i,icon:"flaky",direction:"left",padding:"none",round:"",dense:"",flat:"",glossy:"",class:"q-ma-none q-pa-none"},{default:d(()=>[n(N,{color:"secondary",icon:"fact_check",round:"",dense:"",glossy:"",onClick:i=>m.on_pick_select_click(l)},{default:d(()=>[n(E,null,{default:d(()=>[V(w(o.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),l.value?(r(),u(N,{key:0,color:"negative",icon:"delete_forever",round:"",dense:"",glossy:"",onClick:i=>m.on_pick_remove_click(l)},{default:d(()=>[n(E,null,{default:d(()=>[V(w(o.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):k("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(r(),u(Q,{key:5,type:l.type,label:l.label,readonly:!l.editable,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128)),e.template.childrenFirst?(r(),b("div",re,[e.is_edit&&e.template.children?.length?(r(),b("div",de,[(r(!0),b(x,null,C(e.template.children,(l,_)=>(r(),u(f,{key:_,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:i=>m.on_table_click(l)},null,8,["label","onClick"]))),128))])):k("",!0),e.is_edit&&e.template.forms?.length?(r(),b("div",ce,[(r(!0),b(x,null,C(e.template.forms,(l,_)=>(r(),u(f,{key:_,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:e.loading["form_"+_],onClick:i=>m.on_form_click(l,_)},null,8,["label","loading","onClick"]))),128))])):k("",!0)])):(r(),b("div",me,[e.is_edit&&e.template.forms?.length?(r(),b("div",ue,[(r(!0),b(x,null,C(e.template.forms,(l,_)=>(r(),u(f,{key:_,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:e.loading["form_"+_],onClick:i=>m.on_form_click(l,_)},null,8,["label","loading","onClick"]))),128))])):k("",!0),e.is_edit&&e.template.children?.length?(r(),b("div",pe,[(r(!0),b(x,null,C(e.template.children,(l,_)=>(r(),u(f,{key:_,label:l.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:i=>m.on_table_click(l)},null,8,["label","onClick"]))),128))])):k("",!0)]))]),_:1}),n(F),n(Z,{class:"row"},{default:d(()=>[h("div",_e,[q(n(f,{label:o.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:e.saving},null,8,["label","disable"]),[[P]])]),h("div",be,[e.is_edit&&e.template.copy!==!1&&e.crud.permission.add(e.template)?(r(),u(f,{key:0,label:o.$t("label.copy"),color:"purple","no-caps":"",glossy:"",disable:e.saving,onClick:m.on_clone_click},null,8,["label","disable","onClick"])):k("",!0)]),h("div",ge,[n(f,{label:o.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:e.saving,onClick:m.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),n(T,{modelValue:e.dialog.pick.show,"onUpdate:modelValue":s[1]||(s[1]=l=>e.dialog.pick.show=l),persistent:"","transition-show":"slide-down","transition-hide":"slide-down","backdrop-filter":"blur(1px)"},{default:d(()=>[n(v,{parameters:e.dialog.pick.parameters,onClose:m.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"]),n(T,{modelValue:e.dialog.table.show,"onUpdate:modelValue":s[2]||(s[2]=l=>e.dialog.table.show=l),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)","full-height":""},{default:d(()=>[n(g,{parameters:e.dialog.table.parameters,onClose:m.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"]),n(T,{modelValue:e.dialog.form.show,"onUpdate:modelValue":s[3]||(s[3]=l=>e.dialog.form.show=l),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:d(()=>[n(R,{parameters:e.dialog.form.parameters,onClose:m.on_close_dialog_form},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const De=G(te,[["render",ye]]);export{De as default};
