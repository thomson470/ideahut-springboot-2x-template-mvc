const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FormV-w3SOI3We.js","assets/format-B8DKuPGh.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/QTooltip-D4R9T5Fc.js","assets/ClosePopup-LSrQ-VjT.js","assets/TouchPan-B1-PqlLb.js","assets/Index-2Zuzj8Ve.js","assets/QSpace-CfwQ6zIi.js","assets/QTable-CXYRITav.js","assets/QInnerLoading-DKttGab9.js","assets/QSpinnerGears-BOF8vRdR.js","assets/Table3-DaxbvJfy.js"])))=>i.map(i=>d[i]);
import{_ as S,ag as V,Y as v,a7 as m,$ as a,f as u,a0 as g,C as q,Z as p,ai as C,a1 as j,a4 as Q,a5 as F,a3 as w,a2 as k,F as h,a8 as x,aj as A,ah as E,al as I,r as b,am as T}from"./index-ZajWnxG1.js";import{Q as P,b as D,a as L}from"./format-B8DKuPGh.js";import{Q as U}from"./QTooltip-D4R9T5Fc.js";import{C as B}from"./ClosePopup-LSrQ-VjT.js";import{T as N}from"./TouchPan-B1-PqlLb.js";import{c as e}from"./Index-2Zuzj8Ve.js";import"./QSpace-CfwQ6zIi.js";import"./QTable-CXYRITav.js";import"./QInnerLoading-DKttGab9.js";import"./QSpinnerGears-BOF8vRdR.js";let o;const R={props:["parameters"],components:{FormV:V(()=>T(()=>import("./FormV-w3SOI3We.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Table3:V(()=>T(()=>import("./Table3-DaxbvJfy.js"),__vite__mapDeps([12,2,3,1,4,9,8,10,6,7,11])))},setup(){return{crud:e,title:b(null),fields:b([]),template:b(null),forms:b([]),tables:b([]),loading:b({}),replica:b(null),onlyView:b(!1),dialog:b({main:e.dialog.init(()=>o.dialog.main),form:e.dialog.init(),table:e.dialog.init()})}},created(){o=this;let i=e.get.object(o.parameters),r=e.get.object(i.row),n=e.get.object(i.definition);o.title=e.isString(i.title)?i.title:n.title,o.replica=e.get.number(i.replica,null),o.onlyView=i.onlyView==!0,o.fields=[];let l=e.get.array(n.table.columns),f,s=!1;for(const d of l)!s&&n.id.fields.includes(d.field)&&(s=!0),f=e.getFieldValue(d.field,r),e.isFunction(d.format)&&(f=d.format(f,r)),o.fields.push({label:d.label,value:f});if(!s){let d=e.id.toPk(n.id,r);e.isDefined(d)&&d!==null&&o.fields.splice(0,0,{label:"ID",value:d})}o.forms=e.get.array(n.forms),o.tables=e.get.array(n.children),o.definition=n},methods:{on_form_click(i,r){let n=e.get.object(o.parameters),l=e.get.object(n.definition),f=e.get.object(n.row),s=e.get.array(i.relations);if(!s.length){e.error("error.required","label.relation");return}let d=[];for(const t of s)d.push({field:t.target,condition:"EQUAL",value:e.getFieldValue(t.source,f)});let _=e.copy(i.crud);_.filters=e.isArray(_.filters)?_.filters:[],_.filters=_.filters.concat(d),e.isNumber(o.replica)&&(_.replica=o.replica),o.loading["form_"+r]=!0,e.api.call({path:"/crud/single",method:"post",data:_,onFinish(){o.loading["form_"+r]=!1},onSuccess(t){t=e.get.object(t),e.inject.pkAndGridId(i.id,t,l._grid_id_),e.dialog.show(o.dialog.form,{template:l,form:i,data:t,replica:o.replica})}})},on_table_click(i){let r=e.get.object(o.parameters),n=e.get.object(r.template),l=e.get.object(r.row),f=e.copy(e.get.array(i.relations));if(!f.length){e.error("error.required","label.relation");return}for(const s of f)s.value=e.getFieldValue(s.source,l);i._grid_id_=n._grid_id_,e.dialog.show(o.dialog.table,{template:n,definition:i,parentRow:l,relations:f,onlyView:r.onlyView,replica:o.replica})},on_close_dialog_table(){e.dialog.hide(o.dialog.table)}}},O={key:0},z={key:0},G={key:0,class:"q-mb-xs",style:{width:"100%"}},Y={key:1,class:"q-mb-xs",style:{width:"100%"}},Z={key:1},H={key:0,class:"q-mb-xs",style:{width:"100%"}},J={key:1,class:"q-mb-xs",style:{width:"100%"}};function K(i,r,n,l,f,s){const d=v("FormV"),_=v("Table3");return a(),m(h,null,[u(E,{style:j("width: "+(i.$q.screen.lt.md?"100%;":"50%;")+l.dialog.main.style)},{default:g(()=>[q((a(),p(C,{class:"q-pa-none header-main",style:j(l.crud.config?.color?.header?"background: "+l.crud.config.color.header+" !important;":"")},{default:g(()=>[u(P,{class:"q-pr-none"},{default:g(()=>[u(D,null,{default:g(()=>[u(L,{class:"text-h6 text-white"},{default:g(()=>[Q(F(l.title),1)]),_:1})]),_:1}),u(D,{side:""},{default:g(()=>[q((a(),p(w,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close"},{default:g(()=>[u(U,null,{default:g(()=>[Q(F(i.$t("label.close")),1)]),_:1})]),_:1})),[[B]])]),_:1})]),_:1})]),_:1},8,["style"])),[[N,l.dialog.main.onDrag,void 0,{mouse:!0}]]),u(C,{style:{"max-height":"75vh"},class:"q-pa-xs q-mt-none scroll"},{default:g(()=>[(a(!0),m(h,null,x(l.fields,(t,c)=>(a(),p(A,{type:"text",key:c,label:t.label,modelValue:t.value,"onUpdate:modelValue":y=>t.value=y,readonly:"",filled:"",autogrow:"",class:"q-mb-xs",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","modelValue","onUpdate:modelValue"]))),128)),l.onlyView?(a(),m("div",O,[i.definition.childrenFirst?(a(),m("div",z,[l.tables.length?(a(),m("div",G,[(a(!0),m(h,null,x(l.tables,(t,c)=>(a(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:y=>s.on_table_click(t)},null,8,["label","onClick"]))),128))])):k("",!0),l.forms.length?(a(),m("div",Y,[(a(!0),m(h,null,x(l.forms,(t,c)=>(a(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:l.loading["form_"+c],onClick:y=>s.on_form_click(t,c)},null,8,["label","loading","onClick"]))),128))])):k("",!0)])):(a(),m("div",Z,[l.forms.length?(a(),m("div",H,[(a(!0),m(h,null,x(l.forms,(t,c)=>(a(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:l.loading["form_"+c],onClick:y=>s.on_form_click(t,c)},null,8,["label","loading","onClick"]))),128))])):k("",!0),l.tables.length?(a(),m("div",J,[(a(!0),m(h,null,x(l.tables,(t,c)=>(a(),p(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:y=>s.on_table_click(t)},null,8,["label","onClick"]))),128))])):k("",!0)]))])):k("",!0)]),_:1})]),_:1},8,["style"]),u(I,{modelValue:l.dialog.form.show,"onUpdate:modelValue":r[0]||(r[0]=t=>l.dialog.form.show=t),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:g(()=>[u(d,{parameters:l.dialog.form.parameters},null,8,["parameters"])]),_:1},8,["modelValue"]),u(I,{modelValue:l.dialog.table.show,"onUpdate:modelValue":r[1]||(r[1]=t=>l.dialog.table.show=t),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)","full-height":""},{default:g(()=>[u(_,{parameters:l.dialog.table.parameters,onClose:s.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const re=S(R,[["render",K]]);export{re as default};
