const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FormV-w3SOI3We.js","assets/format-B8DKuPGh.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/QTooltip-D4R9T5Fc.js","assets/ClosePopup-LSrQ-VjT.js","assets/TouchPan-B1-PqlLb.js","assets/Index-2Zuzj8Ve.js","assets/QSpace-CfwQ6zIi.js","assets/QTable-CXYRITav.js","assets/QInnerLoading-DKttGab9.js","assets/QSpinnerGears-BOF8vRdR.js","assets/Table1-BawP0C-N.js"])))=>i.map(i=>d[i]);
import{_ as S,ag as v,Y as V,a7 as m,$ as o,f,a0 as g,C as q,Z as b,ai as C,a1 as j,a4 as Q,a5 as F,a3 as w,F as h,a8 as k,aj as A,a2 as x,ah as E,al as I,r as p,am as T}from"./index-ZajWnxG1.js";import{Q as P,b as D,a as L}from"./format-B8DKuPGh.js";import{Q as U}from"./QTooltip-D4R9T5Fc.js";import{C as B}from"./ClosePopup-LSrQ-VjT.js";import{T as N}from"./TouchPan-B1-PqlLb.js";import{c as e}from"./Index-2Zuzj8Ve.js";import"./QSpace-CfwQ6zIi.js";import"./QTable-CXYRITav.js";import"./QInnerLoading-DKttGab9.js";import"./QSpinnerGears-BOF8vRdR.js";let a;const R={props:["parameters"],components:{FormV:v(()=>T(()=>import("./FormV-w3SOI3We.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Table1:v(()=>T(()=>import("./Table1-BawP0C-N.js"),__vite__mapDeps([12,2,3,1,4,9,8,10,6,7,11])))},setup(){return{crud:e,title:p(null),fields:p([]),template:p(null),forms:p([]),tables:p([]),loading:p({}),replica:p(null),dialog:p({main:e.dialog.init(()=>a.dialog.main),form:e.dialog.init(),table:e.dialog.init()})}},created(){a=this;let r=e.get.object(a.parameters),s=e.get.object(r.row),n=e.get.object(r.template);a.title=e.isString(r.title)?r.title:n.title,a.replica=e.get.number(r.replica,null),a.fields=[];let l=e.get.array(n.table.columns),u,i=!1;for(const d of l)!i&&n.id.fields.includes(d.field)&&(i=!0),u=e.getFieldValue(d.field,s),e.isFunction(d.format)&&(u=d.format(u,s)),a.fields.push({label:d.label,value:u});if(!i){let d=e.id.toPk(n.id,s);e.isDefined(d)&&d!==null&&a.fields.splice(0,0,{label:"ID",value:d})}a.forms=e.get.array(n.forms),a.tables=e.get.array(n.children),a.template=n},methods:{on_form_click(r,s){let n=e.get.object(a.parameters),l=e.get.object(n.template),u=e.get.object(n.row),i=e.get.array(r.relations);if(!i.length){e.error("error.required","label.relation");return}let d=[];for(const t of i)d.push({field:t.target,condition:"EQUAL",value:e.getFieldValue(t.source,u)});let _=e.copy(r.crud);_.filters=e.isArray(_.filters)?_.filters:[],_.filters=_.filters.concat(d),e.isNumber(a.replica)&&(_.replica=a.replica),a.loading["form_"+s]=!0,e.api.call({path:"/crud/single",method:"post",data:_,onFinish(){a.loading["form_"+s]=!1},onSuccess(t){t=e.get.object(t),e.inject.pkAndGridId(r.id,t,l._grid_id_),e.dialog.show(a.dialog.form,{template:l,form:r,data:t,replica:a.replica})}})},on_table_click(r){let s=e.get.object(a.parameters),n=e.get.object(s.template),l=e.get.object(s.row),u=e.copy(e.get.array(r.relations));if(!u.length){e.error("error.required","label.relation");return}for(const i of u)i.value=e.getFieldValue(i.source,l);r._grid_id_=n._grid_id_,e.dialog.show(a.dialog.table,{template:n,definition:r,parentRow:l,relations:u,onlyView:!0,replica:a.replica})},on_close_dialog_table(){e.dialog.hide(a.dialog.table)}}},O={key:0},z={key:0,class:"q-mb-xs",style:{width:"100%"}},G={key:1,class:"q-mb-xs",style:{width:"100%"}},Y={key:1},Z={key:0,class:"q-mb-xs",style:{width:"100%"}},H={key:1,class:"q-mb-xs",style:{width:"100%"}};function J(r,s,n,l,u,i){const d=V("FormV"),_=V("Table1");return o(),m(h,null,[f(E,{style:j("width: "+(r.$q.screen.lt.md?"100%;":"50%;")+l.dialog.main.style)},{default:g(()=>[q((o(),b(C,{class:"header-main",style:j(l.crud.config?.color?.header?"background: "+l.crud.config.color.header+" !important;":"")},{default:g(()=>[f(P,{class:"q-pr-none"},{default:g(()=>[f(D,null,{default:g(()=>[f(L,{class:"text-h6 text-white"},{default:g(()=>[Q(F(l.title),1)]),_:1})]),_:1}),f(D,{side:""},{default:g(()=>[q((o(),b(w,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close"},{default:g(()=>[f(U,null,{default:g(()=>[Q(F(r.$t("label.close")),1)]),_:1})]),_:1})),[[B]])]),_:1})]),_:1})]),_:1},8,["style"])),[[N,l.dialog.main.onDrag,void 0,{mouse:!0}]]),f(C,{style:{"max-height":"75vh"},class:"q-pa-xs q-mt-none scroll"},{default:g(()=>[(o(!0),m(h,null,k(l.fields,(t,c)=>(o(),b(A,{type:"text",key:c,label:t.label,modelValue:t.value,"onUpdate:modelValue":y=>t.value=y,readonly:"",filled:"",autogrow:"",class:"q-mb-xs",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","modelValue","onUpdate:modelValue"]))),128)),l.template.childrenFirst?(o(),m("div",O,[l.tables.length?(o(),m("div",z,[(o(!0),m(h,null,k(l.tables,(t,c)=>(o(),b(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:y=>i.on_table_click(t)},null,8,["label","onClick"]))),128))])):x("",!0),l.forms.length?(o(),m("div",G,[(o(!0),m(h,null,k(l.forms,(t,c)=>(o(),b(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:l.loading["form_"+c],onClick:y=>i.on_form_click(t,c)},null,8,["label","loading","onClick"]))),128))])):x("",!0)])):(o(),m("div",Y,[l.forms.length?(o(),m("div",Z,[(o(!0),m(h,null,k(l.forms,(t,c)=>(o(),b(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",loading:l.loading["form_"+c],onClick:y=>i.on_form_click(t,c)},null,8,["label","loading","onClick"]))),128))])):x("",!0),l.tables.length?(o(),m("div",H,[(o(!0),m(h,null,k(l.tables,(t,c)=>(o(),b(w,{key:c,label:t.title,class:"full-width q-mt-xs q-mb-xs text-weight-bold","no-caps":"",glossy:"",onClick:y=>i.on_table_click(t)},null,8,["label","onClick"]))),128))])):x("",!0)]))]),_:1})]),_:1},8,["style"]),f(I,{modelValue:l.dialog.form.show,"onUpdate:modelValue":s[0]||(s[0]=t=>l.dialog.form.show=t),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:g(()=>[f(d,{parameters:l.dialog.form.parameters},null,8,["parameters"])]),_:1},8,["modelValue"]),f(I,{modelValue:l.dialog.table.show,"onUpdate:modelValue":s[1]||(s[1]=t=>l.dialog.table.show=t),"transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)","full-height":""},{default:g(()=>[f(_,{parameters:l.dialog.table.parameters,onClose:i.on_close_dialog_table},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const re=S(R,[["render",J]]);export{re as default};
