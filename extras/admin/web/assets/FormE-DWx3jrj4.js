const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pick-CYwS7Ngw.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/format-B8DKuPGh.js","assets/QTooltip-D4R9T5Fc.js","assets/QSpace-CfwQ6zIi.js","assets/QInnerLoading-DKttGab9.js","assets/QTable-CXYRITav.js","assets/ClosePopup-LSrQ-VjT.js","assets/TouchPan-B1-PqlLb.js","assets/Index-2Zuzj8Ve.js","assets/QSpinnerGears-BOF8vRdR.js"])))=>i.map(i=>d[i]);
import{_ as B,ag as I,Y as E,a7 as V,$ as c,f as r,a0 as i,C as f,Z as u,ai as U,a1 as C,a4 as v,a5 as p,a3 as k,a9 as _,F as q,a8 as A,aj as h,G as N,a2 as g,Q as w,an as L,ak as z,ah as G,al as R,r as m,am as Y}from"./index-ZajWnxG1.js";import{Q as Z,b as j,a as $}from"./format-B8DKuPGh.js";import{Q}from"./QTooltip-D4R9T5Fc.js";import{a as P}from"./QTable-CXYRITav.js";import{Q as H,a as S,b as J,c as F,d as K,e as M}from"./QTabPanels-HGFJe3oi.js";import{Q as W}from"./QPopupProxy-D0Ly69kw.js";import{Q as X,a as T}from"./QFab-CHynsvqb.js";import{C as x}from"./ClosePopup-LSrQ-VjT.js";import{T as ee}from"./TouchPan-B1-PqlLb.js";import{c as o}from"./Index-2Zuzj8Ve.js";import"./QResizeObserver-CqC5UUgk.js";import"./QSpace-CfwQ6zIi.js";import"./QInnerLoading-DKttGab9.js";import"./QSpinnerGears-BOF8vRdR.js";let a;const ae={props:["parameters"],emits:["close"],components:{Pick:I(()=>Y(()=>import("./Pick-CYwS7Ngw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])))},setup(){return{crud:o,id:m(null),title:m(""),is_edit:m(!1),saving:m(!1),index:m(null),fields:m(null),form:m(null),template:m({options:{},enums:{}}),replica:m(null),relations:m([]),enums:m({}),options:m({}),row:m(null),dialog:m({main:o.dialog.init(()=>a.dialog.main),pick:o.dialog.init()})}},created(){a=this;let t=o.get.object(a.parameters),d=o.get.object(t.form);a.template=o.get.object(t.template),a.replica=t.replica,a.row=t.row,a.relations=o.get.array(t.relations),a.enums={},o.isObject(a.template.enums)&&Object.keys(a.template.enums).forEach(l=>{a.enums[l]=[null].concat(a.template.enums[l])}),a.options={},o.isObject(a.template.options)&&Object.keys(a.template.options).forEach(l=>{a.options[l]=[null].concat(a.template.options[l])}),a.data=o.get.object(t.data),a.form=d,a.fields=[],a.is_edit=t.is_edit,a.title=(o.isString(d.title)&&d.title!==""?d.title+" - ":"")+(a.is_edit?a.$t("label.edit"):a.$t("label.new"));let b=o.get.array(d.fields);if(a.is_edit){a.id=o.id.fromPk(a.form.id,a.data._pk_);for(const l of b){let n=o.clone.field(l);n.value=o.getFieldValue(n.name,a.data),n.type==="datetime"&&n.converter==="epoch"?n.value=o.format.date(n.value,{format:n.pattern||null}):n.type==="pick"?o.isDefined(n.value)&&(n.text=o.isFunction(n.format)?n.format(n.value,t.row):n.value+""):o.isFunction(n.format)&&(n.text=n.format(n.value,t.row)),(n.insertable===!0||n.editable===!0||n.type==="title")&&a.fields.push(n)}}else for(const l of b)if(l.insertable||l.type==="title"){let n=o.clone.field(l);n.editable=!0,a.fields.push(n)}},methods:{on_pick_select_click(t){let d=a.template.picks[t.pick];if(!o.isObject(d)){o.error("error.required","label.pick");return}let b=o.isArray(d.relations)?d.relations:[];for(const l of b)if(l.value=o.getFieldValue(l.source,a.row),!o.isDefined(l.value)){let n=a.fields.find(y=>y.name===l.source);o.runIf(o.isObject(n),()=>{l.value=o.isFunction(n.toValue)?n.toValue(n.value):n.value,l.value=o.isObject(l.value)?l.value[l.source]:l.value})}o.dialog.show(a.dialog.pick,{template:a.template,field:t,pick:d,relations:b,replica:a.replica})},on_pick_remove_click(t){t.value=void 0,t.text=void 0},on_close_dialog_pick(t){if(t?._pk_){let d=a.dialog.pick.parameters.field,b=o.isFunction(d.format)?d.format(t):t+"";d.value=t,d.text=b}o.dialog.hide(a.dialog.pick)},on_save_click(){a.form._grid_id_=a.template._grid_id_,o.action.save({id:a.id,fields:a.fields,definition:a.form,replica:a.replica,relations:a.relations,is_edit:a.is_edit,saving:a.saving,onSuccess:function(t){a.$emit("close",{row:t,is_edit:a.is_edit,index:a.index})}})}}},le={class:"row"},te={key:0,class:"text-h6 text-center text-bold"},oe={class:"bg-primary"},ne={class:"q-pa-xs bg-white row"},se={class:"col-6 text-left"},ie={class:"col-6 text-right"},re={class:"col-6 q-pr-xs text-left"},de={class:"col-6 q-pl-xs text-right"};function ce(t,d,b,l,n,y){const D=E("Pick");return c(),V(q,null,[r(G,{style:C("width: "+(t.$q.screen.lt.md?"100%;":"50%;")+l.dialog.main.style)},{default:i(()=>[f((c(),u(U,{class:"q-pa-none header-main",style:C(l.crud.config?.color?.header?"background: "+l.crud.config.color.header+" !important;":"")},{default:i(()=>[r(Z,{class:"q-pr-none"},{default:i(()=>[r(j,null,{default:i(()=>[r($,{class:"text-h6 text-white"},{default:i(()=>[v(p(l.title),1)]),_:1})]),_:1}),r(j,{side:""},{default:i(()=>[f((c(),u(k,{class:"text-caption text-white q-pl-xs q-pr-xs q-mr-xs",flat:"",round:"",glossy:"",icon:"close",disable:l.saving},{default:i(()=>[r(Q,null,{default:i(()=>[v(p(t.$t("label.close")),1)]),_:1})]),_:1},8,["disable"])),[[x]])]),_:1})]),_:1})]),_:1},8,["style"])),[[ee,l.dialog.main.onDrag,void 0,{mouse:!0}]]),r(U,{style:{"max-height":"80vh"},class:"q-pa-xs q-mt-xs scroll"},{default:i(()=>[_("div",le,[(c(!0),V(q,null,A(l.fields,(e,O)=>(c(),V("div",{key:O,class:"col-md-6 col-sm-12 q-mb-xs",style:{width:"100%"}},[e.type==="title"?(c(),V("div",te,p(e.label),1)):e.type==="words"?(c(),u(h,{key:1,type:"text",label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,filled:"",autogrow:"",style:{"max-height":"200px",overflow:"scroll"}},null,8,["label","readonly","modelValue","onUpdate:modelValue"])):e.type==="enum"?(c(),u(P,{key:2,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,label:e.label,readonly:e.editable!==!0,options:l.enums[e.enum],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},{"selected-item":i(s=>[v(p(s.opt?.label||l.enums[e.enum][s.opt]?.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label","readonly","options"])):e.type==="option"?(c(),u(P,{key:3,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,label:e.label,readonly:e.editable!==!0,options:l.options[e.option],"option-value":"value","option-label":"label","emit-value":"","map-options":"",filled:""},{"selected-item":i(s=>[v(p(s.opt?.label||l.options[e.option][s.opt]?.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","label","readonly","options"])):e.type==="datetime"||e.type==="date"||e.type==="time"?(c(),u(h,{key:4,type:"text",label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,filled:""},{append:i(()=>[r(N,{name:e.type==="time"?"schedule":e.type==="date"?"calendar_month":"event",class:"cursor-pointer"},{default:i(()=>[r(W,{"transition-show":"scale","transition-hide":"scale",cover:"",onBeforeShow:s=>l.crud.calendar.beforeShow(e,"tab","proxy_value","value")},{default:i(()=>[_("div",oe,[r(H,{modelValue:e.tab,"onUpdate:modelValue":s=>e.tab=s,class:"bg-primary text-grey-5 shadow-2 text-subtitle2",align:"justify","no-caps":"","indicator-color":"transparent","active-color":"white"},{default:i(()=>[e.type==="datetime"||e.type==="date"?(c(),u(S,{key:0,name:"date"},{default:i(()=>[_("span",null,p(t.$t("label.date")),1)]),_:1})):g("",!0),e.type==="datetime"||e.type==="time"?(c(),u(S,{key:1,name:"time"},{default:i(()=>[_("span",null,p(t.$t("label.time")),1)]),_:1})):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),r(w),r(J,{modelValue:e.tab,"onUpdate:modelValue":s=>e.tab=s},{default:i(()=>[e.type==="datetime"||e.type==="date"?(c(),u(F,{key:0,name:"date",class:"q-pa-none"},{default:i(()=>[r(K,{modelValue:e.proxy_value,"onUpdate:modelValue":s=>e.proxy_value=s,mask:e.format,square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):g("",!0),e.type==="datetime"||e.type==="time"?(c(),u(F,{key:1,name:"time",class:"q-pa-none"},{default:i(()=>[r(M,{modelValue:e.proxy_value,"onUpdate:modelValue":s=>e.proxy_value=s,mask:e.format,format24h:"",square:""},null,8,["modelValue","onUpdate:modelValue","mask"])]),_:2},1024)):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),r(w),_("div",ne,[_("div",se,[f(r(k,{label:t.$t("label.cancel"),color:"negative","no-caps":""},null,8,["label"]),[[x]])]),_("div",ie,[f(r(k,{label:t.$t("label.ok"),color:"secondary","no-caps":"",onClick:s=>e.value=e.proxy_value},null,8,["label","onClick"]),[[x]])])])])]),_:2},1032,["onBeforeShow"])]),_:2},1032,["name"])]),_:2},1032,["label","readonly","modelValue","onUpdate:modelValue"])):e.type==="pick"?(c(),u(h,{key:5,type:"text",label:e.label,readonly:!e.editable,modelValue:e.text,"onUpdate:modelValue":s=>e.text=s,filled:""},L({_:2},[e.editable?{name:"append",fn:i(()=>[r(X,{modelValue:e.fab,"onUpdate:modelValue":s=>e.fab=s,icon:"flaky",direction:"left",padding:"none",flat:"",class:"q-ma-none q-pa-none"},{default:i(()=>[r(T,{color:"secondary",icon:"fact_check",onClick:s=>y.on_pick_select_click(e)},{default:i(()=>[r(Q,null,{default:i(()=>[v(p(t.$t("label.select")),1)]),_:1})]),_:2},1032,["onClick"]),e.value?(c(),u(T,{key:0,color:"negative",icon:"delete_forever",onClick:s=>y.on_pick_remove_click(e)},{default:i(()=>[r(Q,null,{default:i(()=>[v(p(t.$t("label.delete")),1)]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),key:"0"}:void 0]),1032,["label","readonly","modelValue","onUpdate:modelValue"])):(c(),u(h,{key:6,type:e.type,label:e.label,readonly:!e.editable,modelValue:e.value,"onUpdate:modelValue":s=>e.value=s,filled:""},null,8,["type","label","readonly","modelValue","onUpdate:modelValue"]))]))),128))])]),_:1}),r(w),r(z,{class:"row"},{default:i(()=>[_("div",re,[f(r(k,{label:t.$t("label.cancel"),color:"negative","no-caps":"",glossy:"",disable:l.saving},null,8,["label","disable"]),[[x]])]),_("div",de,[r(k,{label:t.$t("label.save"),color:"secondary","no-caps":"",glossy:"",loading:l.saving,onClick:y.on_save_click},null,8,["label","loading","onClick"])])]),_:1})]),_:1},8,["style"]),r(R,{modelValue:l.dialog.pick.show,"onUpdate:modelValue":d[0]||(d[0]=e=>l.dialog.pick.show=e),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:i(()=>[r(D,{parameters:l.dialog.pick.parameters,onClose:y.on_close_dialog_pick},null,8,["parameters","onClose"])]),_:1},8,["modelValue"])],64)}const Qe=B(ae,[["render",ce]]);export{Qe as default};
