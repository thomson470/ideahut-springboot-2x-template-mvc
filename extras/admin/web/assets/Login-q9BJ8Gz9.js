import{_ as g,a7 as b,a2 as k,$ as x,a9 as y,f as t,a0 as u,aj as f,G as h,a3 as S,ac as d,ad as _,af as m,ae as p,r as i}from"./index-ZajWnxG1.js";import{Q as w}from"./QForm-B5eZWOd2.js";let s;const V={setup(){return{util:p,uix:d,username:i(null),password:i(null),is_show_login:i(!1),is_in_progress:i(!1),is_show_password:i(!1),is_basic_auth:i(!1)}},beforeCreate(){s=this,m.send({path:"/check",onSuccess(o){let e=o?.headers?o.headers:{};if(p.isString(e["auth-token"])){let r={token:atob(e["auth-token"]),persistent:!0,logout:!1};_.auth(r),s.$router.push({path:"/"})}else s.is_show_login=!0},onError(o){let e=o?.response?o.response:{};if(e.status===401){let r=e?.headers?e.headers:{};if(p.isString(r["www-authenticate"])){let a=r["www-authenticate"],c=a.toLowerCase(),n=c.indexOf(" "),l="";n!=-1&&(l=c.substring(0,n)),l==="basic"?(s.is_show_login=!0,s.is_basic_auth=!0):d.notify(s.$t("error.unsupported_authentication_type"),a,!1)}else s.is_show_login=!0}else s.is_show_login=!0}})},methods:{on_login_click(){let o=s.username;if(!(o&&o.length>0))return d.error("error.required","label.username"),!1;let e=s.password;if(!(e&&e.length>0))return d.error("error.required","label.password"),!1;if(s.is_in_progress=!0,s.is_basic_auth){let r=o+":"+e,a={token:"Basic "+btoa(r),persistent:!0,logout:!0};_.auth(a),m.send({path:"/check",onFinish(){s.is_in_progress=!1},onSuccess(){s.$router.push({path:"/"})},onError(){d.error("error.invalid_authentication")}})}else m.call({path:"/login",method:"post",params:{username:o,password:e},onFinish(){s.is_in_progress=!1},onSuccess(r){p.isString(r)&&r!==""&&(_.auth({token:r,persistent:!1,logout:!0}),_.menu(null),s.$router.push({path:"/"}))}})}}},C={key:0,class:"flex flex-center q-mt-xl"},q={class:"login-form text-center"};function v(o,e,r,a,c,n){return a.is_show_login?(x(),b("div",C,[y("div",q,[t(w,{class:"q-mt-lg",onSubmit:n.on_login_click},{default:u(()=>[t(f,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=l=>a.username=l),class:"q-mb-md",type:"text",placeholder:o.$t("label.username"),rounded:"",outlined:""},{prepend:u(()=>[t(h,{name:"account_box"})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["onSubmit"]),t(w,{onSubmit:n.on_login_click},{default:u(()=>[t(f,{modelValue:a.password,"onUpdate:modelValue":e[2]||(e[2]=l=>a.password=l),class:"q-mb-md",type:a.is_show_password?"text":"password",placeholder:o.$t("label.password"),rounded:"",outlined:""},{prepend:u(()=>[t(h,{name:"lock"})]),append:u(()=>[t(h,{name:a.is_show_password?"visibility":"visibility_off",onClick:e[1]||(e[1]=l=>a.is_show_password=!a.is_show_password)},null,8,["name"])]),_:1},8,["modelValue","type","placeholder"])]),_:1},8,["onSubmit"]),t(S,{"no-caps":"",ripple:"",color:"primary",onClick:n.on_login_click,loading:a.is_in_progress,label:o.$t("label.login")},null,8,["onClick","loading","label"])])])):k("",!0)}const E=g(V,[["render",v]]);export{E as default};
