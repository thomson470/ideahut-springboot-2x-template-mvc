const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AuditSearch-BLCEUhsP.js","assets/format-B8DKuPGh.js","assets/index-ZajWnxG1.js","assets/index-G0ic_0eP.css","assets/QTooltip-D4R9T5Fc.js","assets/QTabPanels-HGFJe3oi.js","assets/QResizeObserver-CqC5UUgk.js","assets/QTable-CXYRITav.js","assets/TouchPan-B1-PqlLb.js","assets/QPopupProxy-D0Ly69kw.js","assets/QForm-B5eZWOd2.js","assets/ClosePopup-LSrQ-VjT.js","assets/TableView-CPalv4dR.js"])))=>i.map(i=>d[i]);
import{_ as O,ag as C,Y,a7 as F,$ as w,f as c,a0 as u,Z as k,a2 as q,a3 as b,aj as z,an as A,a9 as S,a5 as h,a4 as V,G as T,C as x,a1 as N,al as E,F as H,ac as _,ae as l,af as P,r as y,am as Q}from"./index-ZajWnxG1.js";import{Q as L}from"./QSpace-CfwQ6zIi.js";import{e as M}from"./format-B8DKuPGh.js";import{Q as j}from"./QTooltip-D4R9T5Fc.js";import{Q as I}from"./QInnerLoading-DKttGab9.js";import{Q as U}from"./QTable-CXYRITav.js";import{T as B}from"./TouchPan-B1-PqlLb.js";let e;const R={components:{Search:C(()=>Q(()=>import("./AuditSearch-BLCEUhsP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),View:C(()=>Q(()=>import("./TableView-CPalv4dR.js"),__vite__mapDeps([12,1,2,3,4,11])))},setup(){return{util:l,handler:y(null),manager:y(null),type:y(null),info:y({}),definition:{default:{visibles:[],columns:[]},entity:{visibles:[],columns:[]}},table:y({rows:[],visibles:[],columns:[],pagination:{page:1,rowsPerPage:20,sortBy:"entry",descending:!0,count:!1},loading:!1}),search:y({filters:[],empty:!0}),dialog:y({search:_.dialog.init(()=>e.dialog.search),view:_.dialog.init(()=>e.dialog.view)})}},created(){e=this,e.definition.default={visibles:["id","action","replica","auditor","info","type","content","entry"],columns:[{name:"entry",label:e.$t("label.entry"),field:"entry",align:"left",timestamp:!0,pattern:"YYYY-MM-DD HH:mm:ss",sortable:!0,format:function(n,r){return l.format.date(l.getFieldValue("entry",r),{format:"YYYY-MM-DD HH:mm:ss"})}},{name:"id",label:e.$t("label.id"),field:"id",align:"left",type:"java.lang.String",sortable:!0},{name:"action",label:e.$t("label.action"),field:"action",align:"left",type:"java.lang.String",sortable:!0},{name:"replica",label:e.$t("label.replica"),field:"replica",align:"left",type:"java.lang.Integer",sortable:!0},{name:"auditor",label:e.$t("label.auditor"),field:"auditor",align:"left",type:"java.lang.String",sortable:!0},{name:"info",label:e.$t("label.info"),field:"info",align:"left",type:"java.lang.String",sortable:!0},{name:"type",label:e.$t("label.type"),field:"type",align:"left",type:"java.lang.String",sortable:!0},{name:"content",label:e.$t("label.content"),field:"content",align:"left",type:"java.lang.String",sortable:!0}]},e.definition.entity={visibles:["action","replica","auditor","entry"],columns:[{name:"entry",label:e.$t("label.entry"),field:"entry",align:"left",timestamp:!0,pattern:"YYYY-MM-DD HH:mm:ss",sortable:!0,format:function(n,r){return l.format.date(l.getFieldValue("entry",r),{format:"YYYY-MM-DD HH:mm:ss"})}},{name:"action",label:e.$t("label.action"),field:"action",align:"left",type:"java.lang.String",sortable:!0},{name:"replica",label:e.$t("label.replica"),field:"replica",align:"left",type:"java.lang.Integer",sortable:!0},{name:"auditor",label:e.$t("label.auditor"),field:"auditor",align:"left",type:"java.lang.String",sortable:!0},{name:"info",label:e.$t("label.info"),field:"info",align:"left",type:"java.lang.String",sortable:!0}]},e.do_init()},beforeUpdate(){this.do_init()},methods:{get_pagination(n){let r=n?.pagination?n.pagination:e.table.pagination;return r?(e.table.pagination=r,r):e.table.pagination},is_field_visible(n){return n.type==="[B"||n.lob===!0?!1:n.type==="java.lang.String"?n.length<=255:!0},create_search_filters(){let n=e.table.columns,r=e.table.visibles;e.search={filters:[],empty:!0};for(const o of n)if(r.includes(o.name)){let t=!0,s={name:o.name,label:o.label,timestamp:o.timestamp,pattern:o.pattern};o.timestamp===!0?(s.type="datetime",s.condition="BETWEEN",l.isString(o.format)&&(s.pattern=o.format)):o.type==="java.lang.String"?(s.type=o.length>100?"words":"text",s.condition="ANY_LIKE"):o.type==="java.lang.Character"?(s.type="text",s.condition="EQUAL"):o.type==="java.time.LocalDateTime"?(s.type="datetime",s.pattern=o.format,s.condition="BETWEEN"):o.type==="java.lang.Integer"||o.type==="java.lang.Long"?(s.type="number",s.condition="EQUAL"):t=!1,t&&e.search.filters.push(s)}},do_init(){let n=e.$route.query.handler,r=e.$route.query.manager,o=e.$route.query.type;if(n===e.handler&&r===e.manager&&o===e.type)return;let t="YYYY-MM-DD HH:mm:ss";e.handler=n,e.manager=r,e.type=o,e.type!=="_"?(e.table.columns=[...e.definition.entity.columns],e.table.visibles=[...e.definition.entity.visibles],P.call({path:"/audit/info",params:{handler:e.handler,type:e.type,manager:e.manager},onSuccess(s){if(l.isObject(s)){e.info=s;for(const i of e.info.fields){e.is_field_visible(i)&&e.table.visibles.push("content."+i.name);let p=!0,f={name:"content."+i.name,label:i.label,field:"content",align:"left",type:i.type,sortable:!0,format:function(a){let m=l.isObject(a)?l.getFieldValue(i.name,a):a;return m=l.isObject(m)?JSON.stringify(m):m,m}};l.isString(i.format)&&(f.pattern=i.format),e.info.isSoftDelete===!0&&i.name==="deletedOn"?(f.timestamp=!0,f.pattern=l.isString(i.format)?i.format:t,f.format=function(a){try{return l.format.date(l.getFieldValue("deletedOn",a),{format:t})}catch{return a}}):e.info.isAuditEntity===!0&&(i.name==="createdOn"?(f.timestamp=!0,f.pattern=l.isString(i.format)?i.format:t,f.format=function(a){try{return l.format.date(l.getFieldValue("createdOn",a),{format:t})}catch{return a}}):i.name==="updatedOn"?(f.timestamp=!0,f.pattern=l.isString(i.format)?i.format:t,f.format=function(a){try{return l.format.date(l.getFieldValue("updatedOn",a),{format:t})}catch{return a}}):(i.name==="createdBy"||i.name==="updatedBy")&&(p=!1)),p&&e.table.columns.push(f)}e.create_search_filters(),e.do_request()}}})):(e.table.columns=[...e.definition.default.columns],e.table.visibles=[...e.definition.default.visibles],e.create_search_filters(),e.do_request())},do_request(n){let{page:r,rowsPerPage:o,sortBy:t,descending:s}=e.get_pagination(n),i=[],p=e.search;if(!p.empty){let a,m;for(const d of p.filters)if(a=l.isDefined(d.value)?d.value:"",a!=="")if(d.condition==="BETWEEN")m=l.isDefined(d.value2)?d.value2:"",m!==""&&(d.type==="datetime"&&d.timestamp===!0&&(a=l.parse.epoch(a,{format:d.pattern||null}),m=l.parse.epoch(m,{format:d.pattern||null})),i.push({field:d.name,condition:d.condition,values:[a,m]}));else{d.type==="datetime"&&d.timestamp===!0&&(a=l.parse.epoch(a,{format:d.pattern||null}));let g=d.or;if(l.isString(g)&&(g=[g]),g=l.isArray(g)?g:[],g.length){let D={logical:"and",filters:[]};for(let v=0;v<g.length;v++)D.filters.push({field:g[v],logical:v===0?"and":"or",condition:d.condition,value:a});i.push(D)}else i.push({field:d.name,condition:d.condition,value:a})}}let f={page:{index:r,size:o,count:e.table.pagination.count===!0},filters:i,manager:e.manager};e.type!=="_"&&(f.entity=e.type),t&&(f.orders=[(s?"-":"")+t]),e.table.loading=!0,P.call({path:"/audit/list",method:"post",params:{handler:e.handler},data:f,onFinish(){e.table.loading=!1},onSuccess(a){if(l.isObject(a)){e.table.rows=l.isArray(a.data)?a.data:[];let m=e.table.pagination;if(m.page=a.index,m.rowsPerPage=a.size,l.isNumber(a.records))m.rowsNumber=a.records;else{let d=a.index*a.size;e.table.rows.length!==a.size?m.rowsNumber=d:m.rowsNumber=d+1}}}})},on_search_click(){_.dialog.show(e.dialog.search,{filters:e.search.filters})},on_close_dialog_search(n){if(l.isArray(n)){let r=e.search;r.filters=n,r.empty=!0;for(const o of r.filters){let t=l.isDefined(o.value)?o.value:"",s=l.isDefined(o.value2)?o.value2:"";if(t!==""||s!==""){r.empty=!1;break}}_.dialog.hide(e.dialog.search),e.table.pagination.page=1,e.do_request({pagination:e.table.pagination})}},on_refresh_click(){e.table.rows?.length||e.table.pagination.page>1&&(e.table.pagination.page=1),e.do_request({pagination:e.table.pagination})},on_view_click(n){_.dialog.show(e.dialog.view,{scope:n,columns:e.table.columns})},on_page_changed(){let n=+e.table.pagination.page;!isNaN(n)&&n>0&&e.do_request({pagination:e.table.pagination})}}},W={class:"full-width row flex-center text-accent q-gutter-sm"},G={class:"text-subtitle2"},J={class:"text-caption"};function K(n,r,o,t,s,i){const p=Y("Search"),f=Y("View");return w(),F(H,null,[c(U,{class:"table-sticky-header q-ma-sm",rows:t.table.rows,columns:t.table.columns,"visible-columns":t.table.visibles,loading:t.table.loading,selection:"single",pagination:t.table.pagination,"onUpdate:pagination":r[1]||(r[1]=a=>t.table.pagination=a),dense:n.$q.screen.lt.md,"no-data-label":n.$t("error.data_not_available"),"rows-per-page-label":" ","selected-rows-label":a=>{},"rows-per-page-options":[20,40,60,80,100,120,140,160,180,200],"binary-state-sort":"",separator:"cell",onRequest:i.do_request,bordered:""},{top:u(()=>[c(L),c(b,{glossy:"",round:"",dense:"",class:"q-ma-none q-ml-md",color:"deep-orange",icon:"search",onClick:i.on_search_click},{default:u(()=>[t.search.empty?q("",!0):(w(),k(M,{key:0,class:"led-green",floating:""})),c(j,null,{default:u(()=>[V(h(n.$t("label.search")),1)]),_:1})]),_:1},8,["onClick"]),c(b,{glossy:"",round:"",dense:"",class:"q-ma-none q-ml-md",color:"indigo",icon:"refresh",loading:t.table.loading,onClick:i.on_refresh_click},{default:u(()=>[c(j,null,{default:u(()=>[V(h(n.$t("label.refresh")),1)]),_:1})]),_:1},8,["loading","onClick"])]),"no-data":u(({message:a})=>[S("div",W,[c(T,{size:"2em",name:"block"}),S("span",G,h(a),1)])]),loading:u(()=>[c(I,{showing:"",color:"primary"})]),"body-selection":u(a=>[c(b,{glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"deep-purple",icon:"visibility",onClick:m=>i.on_view_click(a)},{default:u(()=>[c(j,null,{default:u(()=>[V(h(n.$t("label.view")),1)]),_:1})]),_:2},1032,["onClick"])]),pagination:u(a=>[a.pagesNumber>2?(w(),k(b,{key:0,glossy:"",size:"sm",icon:"first_page",color:"grey-8",round:"",dense:"",flat:"",disable:a.isFirstPage,onClick:a.firstPage},null,8,["disable","onClick"])):q("",!0),c(b,{glossy:"",size:"sm",icon:"chevron_left",color:"grey-8",class:"q-ml-sm q-mr-xs",round:"",dense:"",flat:"",disable:a.isFirstPage,onClick:a.prevPage},null,8,["disable","onClick"]),c(z,{dense:"",borderless:"",type:"number","input-class":"text-center q-ml-xs q-mr-xs","input-style":"max-width: 60px;",modelValue:t.table.pagination.page,"onUpdate:modelValue":[r[0]||(r[0]=m=>t.table.pagination.page=m),i.on_page_changed]},A({_:2},[t.table.pagination.count===!0?{name:"append",fn:u(()=>[S("span",J," / "+h(a.pagesNumber),1)]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]),c(b,{glossy:"",size:"sm",icon:"chevron_right",color:"grey-8",class:"q-ml-sm q-mr-sm",round:"",dense:"",flat:"",disable:a.isLastPage,onClick:a.nextPage},null,8,["disable","onClick"]),a.pagesNumber>2&&t.table.pagination.count===!0?(w(),k(b,{key:1,glossy:"",size:"sm",icon:"last_page",color:"grey-8",round:"",dense:"",flat:"",disable:a.isLastPage,onClick:a.lastPage},null,8,["disable","onClick"])):q("",!0)]),_:1},8,["rows","columns","visible-columns","loading","pagination","dense","no-data-label","onRequest"]),c(E,{modelValue:t.dialog.search.show,"onUpdate:modelValue":r[2]||(r[2]=a=>t.dialog.search.show=a),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:u(()=>[x(c(p,{parameters:t.dialog.search.parameters,onClose:i.on_close_dialog_search,style:N(t.dialog.search.style)},null,8,["parameters","onClose","style"]),[[B,t.dialog.search.onDrag,void 0,{mouse:!0}]])]),_:1},8,["modelValue"]),c(E,{modelValue:t.dialog.view.show,"onUpdate:modelValue":r[3]||(r[3]=a=>t.dialog.view.show=a),persistent:"","transition-show":"slide-down","transition-hide":"none","backdrop-filter":"blur(1px)"},{default:u(()=>[x(c(f,{parameters:t.dialog.view.parameters,style:N(t.dialog.view.style)},null,8,["parameters","style"]),[[B,t.dialog.view.onDrag,void 0,{mouse:!0}]])]),_:1},8,["modelValue"])],64)}const ie=O(R,[["render",K]]);export{ie as default};
